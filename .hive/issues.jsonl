{"id":"bd-lf2p4u-mjaq5emlbuh","title":"swarm_complete tool fails silently with unhelpful error","description":"**Observed:**\n```\nswarm_complete(\n  project_key=\"/Users/joel/Code/joelhooks/opencode-swarm-plugin\",\n  agent_name=\"GoldForest\",\n  bead_id=\"bd-lf2p4u-mjaq2kcw6zz\",\n  summary=\"...\",\n  files_touched=[\".hive/issues.jsonl\"]\n)\n```\nReturns: `Error: Tool execution failed`\n\n**Expected:**\n- Specific error message explaining WHY it failed\n- Possible causes: bead not found, swarm session not initialized, invalid project_key, etc.\n\n**Impact:**\n- Agent has no idea what went wrong\n- Falls back to manual `hive_close` which skips:\n  - Reservation release\n  - Learning signal recording\n  - UBS scan verification\n\n**Root cause hypothesis:**\n- `swarm_complete` may require `swarmmail_init` to have been called in the same session\n- Or the bead lookup failed silently\n- Or project_key format was wrong\n\n**Fix:**\n- Add proper error messages with actionable guidance\n- Validate inputs and return specific errors:\n  - \"Bead not found: bd-xxx\"\n  - \"Swarm session not initialized - call swarmmail_init first\"\n  - \"Project key mismatch: expected X, got Y\"","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-12-18T00:50:58.509Z","updated_at":"2025-12-18T15:58:01.063Z","dependencies":[],"labels":[],"comments":[]}
{"id":"bd-lf2p4u-mjbmfz6k3i3","title":"Test: verify hive tools work after fix","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T15:54:59.420Z","updated_at":"2025-12-18T15:55:04.162Z","closed_at":"2025-12-18T15:55:04.162Z","dependencies":[],"labels":[],"comments":[]}
{"id":"bd-lf2p4u-mjbmk0v5eop","title":"TDD: Add input validation and helpful errors to swarm_complete","description":"Fix bd-lf2p4u-mjaq5emlbuh - swarm_complete fails silently. Add validation with specific error messages using TDD approach.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-18T15:58:08.225Z","updated_at":"2025-12-18T16:07:33.248Z","closed_at":"2025-12-18T16:07:33.248Z","dependencies":[],"labels":[],"comments":[]}
{"id":"bd-lf2p4u-mjbmk0vhuya","title":"RED: Write failing tests for swarm_complete validation","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-18T15:58:08.237Z","updated_at":"2025-12-18T16:01:07.214Z","closed_at":"2025-12-18T16:01:07.214Z","parent_id":"bd-lf2p4u-mjbmk0v5eop","dependencies":[],"labels":[],"comments":[]}
{"id":"bd-lf2p4u-mjbmk0vlynx","title":"GREEN: Implement validation with specific error messages","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-18T15:58:08.241Z","updated_at":"2025-12-18T16:04:50.803Z","closed_at":"2025-12-18T16:04:50.803Z","parent_id":"bd-lf2p4u-mjbmk0v5eop","dependencies":[],"labels":[],"comments":[]}
{"id":"bd-lf2p4u-mjbmnkstm8b","title":"Cell IDs should use project name prefix instead of generic 'bd'","description":"**Current:** All cell IDs use generic `bd-` prefix (e.g., `bd-lf2p4u-mjbmk0vhuya`)\n\n**Proposed:** Use slugified project name from package.json as prefix:\n- `swarm-mail-lf2p4u-abc123` (for swarm-mail package)\n- `opencode-swarm-plugin-lf2p4u-xyz789` (for the plugin)\n- `my-app-lf2p4u-def456` (for user projects)\n\n**Fallback:** If no package.json or name field, use `cell-` prefix (not `bd-`)\n\n**Benefits:**\n- Cells are identifiable by project at a glance\n- Easier to filter/search across multi-project workspaces\n- Removes legacy \"bead\" terminology from user-facing IDs\n\n**Implementation:**\n1. `generateBeadId()` in swarm-mail should read package.json name\n2. Slugify the name (lowercase, replace spaces/special chars with dashes)\n3. Fallback to `cell` if no package.json found\n4. Keep the random suffix for uniqueness\n\n**Files:**\n- packages/swarm-mail/src/hive/adapter.ts (generateBeadId function)\n- Possibly packages/swarm-mail/src/hive/index.ts","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-18T16:00:54.029Z","updated_at":"2025-12-18T16:00:54.029Z","dependencies":[],"labels":[],"comments":[]}
{"id":"bd-lf2p4u-mjbmtkk49yy","title":"Remove all bd CLI usage from swarm-orchestrate.ts - use HiveAdapter","description":"**Critical:** swarm-orchestrate.ts still uses deprecated `bd` CLI commands instead of HiveAdapter.\n\n**Locations:**\n- Line 95: `bd list --parent ${epicId}` \n- Line 884: `bd update ${args.bead_id} --status`\n- Line 1334: `bd close ${args.bead_id} --reason`\n\n**Per AGENTS.md:**\n> NEVER use `bd` CLI commands in code. The `bd` CLI is deprecated and should not be called via `Bun.$` or any shell execution. Instead, use the **HiveAdapter** from `swarm-mail` package.\n\n**Impact:**\n- swarm_complete fails when bd CLI not installed\n- Workers can't complete tasks properly\n- Tests skip/fail in environments without bd CLI\n\n**Fix:**\nReplace all `Bun.$\\`bd ...\\`` calls with HiveAdapter methods:\n- `bd list --parent` → `adapter.queryCells({ parent_id })`\n- `bd update --status` → `adapter.updateCell(id, { status })`\n- `bd close --reason` → `adapter.closeCell(id, reason)`\n\n**Also affects:**\n- swarm.integration.test.ts (many bd CLI calls in tests)\n- bin/swarm.ts (bd init, bd create)\n- index.ts (bd sync)\n- tool-availability.ts (bd --version check)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-18T16:05:33.652Z","updated_at":"2025-12-18T16:19:48.095Z","closed_at":"2025-12-18T16:19:48.095Z","dependencies":[],"labels":[],"comments":[]}
{"id":"bd-lf2p4u-mjbn5bri7a1","title":"Improve compaction hook swarm detection for better continuation","description":"**Problem:** Swarms are getting lost during compaction because `hasSwarmSign()` is too strict.\n\n**Current detection (too tight):**\n- Only checks hive database for cells\n- Requires `in_progress` status, `open with parent_id`, or `unclosed epic`\n- Silently returns false on any error\n- Doesn't check conversation context at all\n\n**Proposed improvements:**\n\n1. **Check conversation context** - Look for swarm-related tool calls in the session:\n   - `swarm_decompose`, `swarm_spawn_subtask`, `swarm_status`\n   - `swarmmail_init`, `swarmmail_reserve`\n   - `hive_create_epic`\n   \n2. **Broaden hive checks:**\n   - Any cell updated in last hour\n   - Any cell with swarm-related metadata\n   - Any reservations active in swarm-mail\n\n3. **Add fallback prompt** - If uncertain, tell compactor to check:\n   ```\n   If you see ANY of these in context, this is an active swarm:\n   - Epic IDs (bd-xxx)\n   - Agent names (BlueLake, etc.)\n   - File reservations\n   - swarm_* or swarmmail_* tool calls\n   ```\n\n4. **Err on the side of continuation** - Better to inject swarm context unnecessarily than lose a swarm\n\n**Files:**\n- packages/opencode-swarm-plugin/src/compaction-hook.ts","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T16:14:42.126Z","updated_at":"2025-12-18T16:19:48.576Z","closed_at":"2025-12-18T16:19:48.576Z","dependencies":[],"labels":[],"comments":[]}